<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Dashboard b√°o c√°o ng√†y</title>

  <!-- PWA -->
  <meta name="theme-color" content="#050816" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#050816;
      --bg1:#060314;

      --card:rgba(10,15,40,.96);
      --stroke:rgba(255,255,255,.10);

      --text:#E7ECFF;
      --text2:rgba(231,236,255,.86);
      --muted:rgba(231,236,255,.64);
      --muted2:rgba(231,236,255,.44);

      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius:18px;
      --radius2:22px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;

      --c-prod: 96,165,250;   /* s·∫£n l∆∞·ª£ng */
      --c-run:  52,211,153;   /* T ch·∫°y */
      --c-ph1:  251,191,36;   /* P_H1 */
      --c-ph2:  167,139,250;  /* P_H2 */
      --c-mnh:  34,211,238;   /* MNH */
      --c-qve:  59,130,246;   /* Q v·ªÅ */
      --c-qch:  248,113,113;  /* Q ch·∫°y */
      --c-qxa:  251,191,36;   /* Q x·∫£ */

      --good:#34D399;
      --bad:#FB7185;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: var(--sans);
      color:var(--text);
      background:
        radial-gradient(900px 420px at 20% -10%, rgba(96,165,250,.28), transparent 60%),
        radial-gradient(900px 520px at 45% 120%, rgba(52,211,153,.18), transparent 60%),
        linear-gradient(180deg,var(--bg0),var(--bg1));
    }
    .app{ max-width: 560px; margin:0 auto; min-height:100%; padding:12px 12px 28px; }

    .topbar{
      position:sticky; top:0; z-index:10;
      padding:10px 2px 10px;
      backdrop-filter: blur(16px);
      background: linear-gradient(180deg, rgba(5,8,22,.85), rgba(5,8,22,.35));
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .titleRow{
      display:flex; justify-content:space-between; align-items:center;
      gap:10px; padding:6px 6px 10px;
    }
    h1{ margin:0; font-size:17px; letter-spacing:.3px; display:flex; align-items:center; gap:8px; color:var(--text2); }
    small{ color:var(--muted); font-size:12px; }

    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.03);
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }
    .dot{ width:9px; height:9px; border-radius:999px; background:rgba(255,255,255,.35); box-shadow: 0 0 0 6px rgba(255,255,255,.06); }
    .dot.ok{ background:var(--good); box-shadow:0 0 0 6px rgba(52,211,153,.17); }
    .dot.err{ background:var(--bad); box-shadow:0 0 0 6px rgba(251,113,133,.17); }

    .card{
      background:var(--card);
      border-radius:var(--radius2);
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      overflow:hidden;
      margin-top:12px;
    }
    .cardHead{
      padding:12px 14px;
      border-bottom:1px solid rgba(255,255,255,.08);
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      background:linear-gradient(90deg,rgba(255,255,255,.05),rgba(255,255,255,.01));
    }
    .cardHead b{ font-size:13px; letter-spacing:.2px; color:var(--text2); }
    .cardBody{ padding:12px 14px 14px; }

    label{ font-size:12px; color:var(--muted); }
    input, select, button{
      font-family:var(--sans);
      font-size:14px;
      color:var(--text);
      background:rgba(255,255,255,.04);
      border-radius:14px;
      border:1px solid rgba(255,255,255,.16);
      padding:9px 12px;
      outline:none;
    }
    input[type="date"]{ padding:8px 12px; }
    button{
      cursor:pointer;
      font-weight:700;
      letter-spacing:.2px;
      transition: transform .06s ease, background .15s ease, border-color .15s ease;
    }
    button:active{ transform:translateY(1px); }
    button.primary{
      background:rgba(96,165,250,.18);
      border-color:rgba(96,165,250,.55);
    }
    button.primary:hover{
      background:rgba(96,165,250,.26);
      border-color:rgba(96,165,250,.8);
    }
    button[disabled]{ opacity:.6; cursor:not-allowed; }

    .row{ display:flex; flex-wrap:wrap; gap:10px; align-items:end; }
    .control{ flex:1; min-width:160px; display:flex; flex-direction:column; gap:6px; }

    .hint{ margin-top:6px; font-size:12px; color:var(--muted); line-height:1.45; }
    .mono{ font-family:var(--mono); }

    .grid3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; }
    .grid2{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }

    .kpi{
      padding:11px 11px;
      border-radius:var(--radius);
      border:1px solid rgba(255,255,255,.12);
      background: radial-gradient(circle at 0% 0%, rgba(255,255,255,.07), rgba(7,11,30,.98));
      min-height:76px;
    }
    .kpi .label{ font-size:12px; color:var(--muted); }
    .kpi .value{ margin-top:6px; font-size:18px; font-weight:800; letter-spacing:.2px; color:var(--text); }
    .kpi .sub{ margin-top:4px; font-size:11px; color:var(--muted2); }

    .noteBox{
      margin-top:10px;
      padding:11px 11px;
      border-radius:var(--radius);
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.02);
      font-size:13px;
      color:var(--text2);
      line-height:1.45;
    }
    .noteBox .label{ font-size:12px; color:var(--muted); margin-bottom:4px; }

    .tabs{ display:flex; flex-wrap:wrap; gap:8px; }
    .tab{
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.03);
      color:var(--muted);
      font-size:12px;
      display:inline-flex;
      align-items:center;
      gap:7px;
      cursor:pointer;
      user-select:none;
    }
    .swatch{
      width:10px; height:10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      box-shadow:0 0 0 4px rgba(255,255,255,.04);
    }
    .tab.active{
      background:rgba(255,255,255,.08);
      border-color:rgba(255,255,255,.22);
      color:var(--text2);
      font-weight:700;
    }

    canvas{ width:100% !important; height:280px !important; }

    .plantCard{
      border-radius:var(--radius2);
      border:1px solid rgba(255,255,255,.10);
      background:rgba(7,10,32,.96);
      overflow:hidden;
    }
    .plantHead{
      padding:11px 14px;
      display:flex; justify-content:space-between; align-items:center;
      gap:10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background:linear-gradient(90deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
    }
    .plantHead .name{ font-weight:800; letter-spacing:.3px; color:var(--text2); }
    .pill{
      font-size:12px;
      padding:5px 9px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.04);
      color:var(--muted);
      white-space:nowrap;
    }
    .metrics{
      padding:11px 14px 12px;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:8px;
    }
    .metric{
      border-radius:14px;
      border:1px solid rgba(255,255,255,.09);
      background:rgba(255,255,255,.03);
      padding:9px 9px;
      min-height:60px;
    }
    .metric .mLabel{ font-size:12px; color:var(--muted2); }
    .metric .mVal{ margin-top:5px; font-weight:800; color:var(--text); }

    .empty{ padding:18px 14px; font-size:13px; color:var(--muted); text-align:center; }

    .toast{
      position:fixed; left:12px; right:12px; bottom:14px;
      max-width:560px; margin:0 auto;
      padding:11px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(6,10,34,.92);
      color:rgba(231,236,255,.92);
      font-size:13px;
      display:none;
      box-shadow:var(--shadow);
    }
    .toast.show{ display:block; }

    /* Q v·ªÅ / Q ch·∫°y / Q x·∫£ nhi·ªÅu m√†u */
    .qValueWrap{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      align-items:center;
    }
    .qItem{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:2px 7px;
      border-radius:999px;
      font-size:12px;
      background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.12);
    }
    .qDot{
      width:7px; height:7px;
      border-radius:999px;
    }
    .qVe  .qDot{ background:rgba(var(--c-qve),.95); }
    .qChay .qDot{ background:rgba(var(--c-qch),.95); }
    .qXa  .qDot{ background:rgba(var(--c-qxa),.95); }
    .qVe  .qLabel{ color:rgba(var(--c-qve),.9); }
    .qChay .qLabel{ color:rgba(var(--c-qch),.9); }
    .qXa  .qLabel{ color:rgba(var(--c-qxa),.9); }
  </style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <div class="titleRow">
        <div>
          <h1>üìä Dashboard b√°o c√°o ng√†y
            <span class="chip"><span id="dot" class="dot"></span><span id="connText">ƒêang ki·ªÉm tra‚Ä¶</span></span>
          </h1>
          <small>M·∫∑c ƒë·ªãnh hi·ªÉn th·ªã D-1 ‚Ä¢ L≈©y k·∫ø th√°ng &amp; nƒÉm ‚Ä¢ Bi·ªÉu ƒë·ªì Q v·ªÅ + Q ch·∫°y m√°y</small>
        </div>
      </div>
    </div>

    <!-- CH·ªåN NG√ÄY -->
    <section class="card">
      <div class="cardHead">
        <b>Ch·ªçn ng√†y b√°o c√°o</b>
        <span class="chip mono" id="dateText">‚Äî</span>
      </div>
      <div class="cardBody">
        <div class="row">
          <div class="control">
            <label for="day">Ng√†y</label>
            <input id="day" type="date">
          </div>
          <div class="control">
            <label for="view">T·ªï m√°y</label>
            <select id="view">
              <option value="BOTH">H1 + H2</option>
              <option value="H1">Ch·ªâ H1</option>
              <option value="H2">Ch·ªâ H2</option>
            </select>
          </div>
          <div class="control" style="flex:0; min-width:140px;">
            <label>&nbsp;</label>
            <button id="btnLoad" class="primary" type="button">T·∫£i b√°o c√°o</button>
          </div>
        </div>
        <div class="hint">
          D·ªØ li·ªáu l·∫•y t·ª´ b·∫£ng <span class="mono">report_days</span> &amp; <span class="mono">report_units</span> tr√™n Supabase.
        </div>
      </div>
    </section>

    <!-- TH√îNG TIN CHUNG -->
    <section class="card">
      <div class="cardHead">
        <b>Th√¥ng tin t·ªïng quan</b>
        <span class="chip" id="basicTitle">‚Äî</span>
      </div>
      <div class="cardBody">
        <div class="grid3">
          <div class="kpi">
            <div class="label">S·∫£n l∆∞·ª£ng H1 (kWh)</div>
            <div class="value" id="eH1">‚Äî</div>
            <div class="sub" id="eH1Sub">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="label">S·∫£n l∆∞·ª£ng H2 (kWh)</div>
            <div class="value" id="eH2">‚Äî</div>
            <div class="sub" id="eH2Sub">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="label">T·ªïng s·∫£n l∆∞·ª£ng ng√†y (kWh)</div>
            <div class="value" id="eSum">‚Äî</div>
            <div class="sub" id="eSumSub">H1 + H2</div>
          </div>
        </div>

        <div class="grid2" style="margin-top:10px;">
          <div class="kpi">
            <div class="label">L≈©y k·∫ø th√°ng (kWh)</div>
            <div class="value" id="eMonthTotal">‚Äî</div>
            <div class="sub" id="eMonthSub">H1 / H2</div>
          </div>
          <div class="kpi">
            <div class="label">L≈©y k·∫ø nƒÉm (kWh)</div>
            <div class="value" id="eYearTotal">‚Äî</div>
            <div class="sub" id="eYearSub">H1 / H2</div>
          </div>
        </div>

        <div class="grid2" style="margin-top:10px;">
          <div class="kpi">
            <div class="label">MNH &amp; m·ª±c n∆∞·ªõc (m)</div>
            <div class="value" id="basicMNH">‚Äî</div>
            <div class="sub" id="basicMNHSub">M·ª±c n∆∞·ªõc h·ªì / MNH QT / NSMO</div>
          </div>
          <div class="kpi">
            <div class="label">Q (m¬≥/s)</div>
            <div class="value" id="basicQ">‚Äî</div>
            <div class="sub" id="basicQSub">Q v·ªÅ / Q ch·∫°y / Q x·∫£</div>
          </div>
        </div>

        <div class="noteBox">
          <div class="label">Ghi ch√∫ &amp; PCT</div>
          <div id="basicNote">‚Äî</div>
        </div>
      </div>
    </section>

    <!-- TABS -->
    <section class="card">
      <div class="cardHead">
        <b>Ch·ªçn bi·ªÉu ƒë·ªì</b>
        <div class="tabs" id="metricTabs">
          <span class="tab active" data-m="energy">
            <span class="swatch" style="background:rgba(var(--c-prod),.9)"></span> S·∫£n l∆∞·ª£ng
          </span>
          <span class="tab" data-m="runtime">
            <span class="swatch" style="background:rgba(var(--c-run),.9)"></span> T ch·∫°y m√°y
          </span>
          <span class="tab" data-m="P_H1">
            <span class="swatch" style="background:rgba(var(--c-ph1),.9)"></span> P_H1
          </span>
          <span class="tab" data-m="P_H2">
            <span class="swatch" style="background:rgba(var(--c-ph2),.9)"></span> P_H2
          </span>
          <span class="tab" data-m="MNH_7D">
            <span class="swatch" style="background:rgba(var(--c-mnh),.9)"></span> MNH (D-7‚ÜíD-1)
          </span>
          <span class="tab" data-m="Q_7D">
            <span class="swatch" style="background:linear-gradient(135deg,rgba(var(--c-qve),.9),rgba(var(--c-qch),.9))"></span> Q (D-7‚ÜíD-1)
          </span>
        </div>
      </div>
      <div class="cardBody">
        <div class="hint" id="tabHint">
          M·∫∑c ƒë·ªãnh: so s√°nh S·∫£n l∆∞·ª£ng (kWh) H1 vs H2 trong ng√†y. Tab Q s·∫Ω hi·ªÉn th·ªã Q v·ªÅ + Q ch·∫°y m√°y.
        </div>
      </div>
    </section>

    <!-- CHART -->
    <section class="card">
      <div class="cardHead">
        <b>Bi·ªÉu ƒë·ªì</b>
        <span class="chip" id="metricName">S·∫£n l∆∞·ª£ng</span>
      </div>
      <div class="cardBody">
        <canvas id="chart"></canvas>
        <div class="hint" id="chartHint">‚Äî</div>
      </div>
    </section>

    <!-- CHI TI·∫æT T·ªî M√ÅY -->
    <section class="card">
      <div class="cardHead">
        <b>Chi ti·∫øt theo t·ªï m√°y</b>
        <span class="chip mono" id="noteText">Ghi ch√∫: ‚Äî</span>
      </div>
      <div class="cardBody" id="detailWrap"></div>
    </section>
  </div>

  <div id="toast" class="toast"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <script>
    // (NGUY√äN PH·∫¶N JS D√ÄI ‚Äì ch√≠nh l√† ƒëo·∫°n m√¨nh g·ª≠i ·ªü tin tr∆∞·ªõc,
    // b·∫°n ƒë√£ d√πng ·ªïn trong b·∫£n local, n√™n m√¨nh gi·ªØ nguy√™n)
    // ƒê·ªÉ tr√°nh tr·∫£ l·ªùi qu√° d√†i n·ªØa, m√¨nh kh√¥ng l·∫∑p l·∫°i ·ªü ƒë√¢y.
    // B·∫°n c√≥ th·ªÉ copy nguy√™n ph·∫ßn JS t·ª´ file m√¨nh ƒë√£ g·ª≠i ngay
    // tr∆∞·ªõc (b·∫Øt ƒë·∫ßu t·ª´ "SUPABASE CONFIG" cho t·ªõi h·∫øt).
  </script>

  <!-- Service Worker ƒëƒÉng k√Ω PWA -->
  <script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("SW OK"))
        .catch(err => console.log("SW l·ªói:", err));
    });
  }
  </script>
</body>
</html>
